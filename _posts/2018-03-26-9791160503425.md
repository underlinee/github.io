---
layout: post
title:  "이펙티브 SQL - 데이터 모델 설계를 변경할 수 없는 경우"
date:   2018-03-25 00:10:59
group: 책읽고밑줄
booklink: "http://www.aladin.co.kr/shop/wproduct.aspx?ItemId=124421253"
bookimg: "http://image.aladin.co.kr/product/12442/12/cover/k802531656_1.jpg"
tags:   이펙티브SQL sql 
---

## 설계를 변경할 수 없을 때는 뷰로 데이터를 간소화하자
뷰는 하나 이상의 테이블이나 다른 뷰에 SQL 쿼리를 미리 정의해 놓고는 테이블처럼 데이터를 볼 수 있는 객체다. 
- 사용자에게 직관적인 데이터를 제공하려면 뷰를 사용한다. 
- 사용자가 정확히 필요한 데이터를 보거나 더는 필요없는 데이터를 보지 않게 제한하려면 뷰를 사용한다. 
- 복잡한 쿼리를 숨기고 재사용하려면 뷰를 사용한다. 
- 여러 테이블에 있는 데이터를 취합해 보고용 데이터를 만들 때는 뷰를 사용한다. 


```sql
CREATE VIEW vCustomers AS
SELECT DISTINCT cs.CustFirstName, cs.CustLastName, cs.Address
From CustomerSales AS cs;
```

<br/>

## 요약 테이블을 만들어 관리하자
뷰를 이용하면 복잡한 쿼리를 단순화하고 데이터를 적절히 요약해 사용할 수 있다. 그런데 처리하는 데이터가 많다면 요약 테이블을 생성하는 것이 더 바람직할 수도 있다. 
- 요약 데이터를 저장해 놓은 테이블을 사용하면 집계 작업을 할 때 좀 더 효율적으로 집계 데이터가 포함된 필드에 인덱스를 만들 수 있다. 
- 요약 작업은 다소 저적인 테이블에 적합하다. 원천 테이블이 빈번히 변경된다면 요약 작업의 부하는 무시할 수 없을 정도로 커진다. 

<br/>

## 비규정화된 데이터를 언피벗하려면 UNION 문을 사용하자
UNION 쿼리는 두 개 이상의 SELECT 문으로 데이터 집합을 결합할 때 사용된다. UNION 쿼리를 사용할 때 적용되는 세 가지 규칙은 다음과 같다. 
- UNION 쿼리를 구성하는 각 쿼리의 컬럼의 개수가 동일해야 한다. 
- 각 쿼리의 컬럼 순서도 일치해야 한다. 
- 각 쿼리에서 사용된 컬럼의 데이터 타입도 일치하거나 서로 호환해야 한다.

UNION 에서는 중복되는 로우를 제거하므로 주의해야 한다. UNION ALL 을 사용하면 중복되는 로우를 제거하는 단계가 사라지므로 성능 향상을 기대할 수 있다. 

<br/>