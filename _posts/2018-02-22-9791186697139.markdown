---
layout: post
title:  "자바 성능 튜닝 - 성능 테스트 접근법"
date:   2018-02-21 00:01:59
categories: Book
tags:	Java 성능 performance 테스트  
---


<br/> 

## 실제 애플리케이션을 테스트하자

성능 테스트를 크기로 분류하면 작은 단위의 테스트와 전체 애플리케이션 테스트가 있다. 작은 단위의 성능을 측정하도록 테스트를 설계하는 경우, 작성하기 어렵고 테스트 결과도 활용에 제한이 많다. 결과에 완전히 의존하지 말고 성능을 가늠하기 위해서 사용하자. 그리고 아래와 같은 점을 주의하자. 

- 관련없는 동작의 포함
- 부정확한 입력값
- 컴파일러의 최적화 영향

전체 애플리케이션 테스트는 코드가 실제로 실행되는 방식을 테스트하기 위한 유일한 방법이다. 외부자원을 포함한 시스템 전체를 테스트하고, 시스템 내의 병목 구간을 확인하는 유일한 방법이기 때문이다. 물론 시스템 전체를 테스트하기는 쉽지 않기 때문에 애플리케이션의 일부를 테스트하는 방식은 합리적인 대안이 될 수 있다. 모듈 단위의 테스트는 자동 테스트 등에 활용하기 좋다. 

<br/> 

## Throughput 및 Response Time 이해하기
측정해야 할 두 가지 요소에는 Throughput 과 Response Time이 있다. throughput 측정은 일정 기간 내에 완료할 수 있는 작업 량으로 측정한다. 클라이언트 스레드가 충분하지 않다면 클라이언트 성능 측정을 하게 되는 경우를 맞닥뜨리기 쉽기 때문에 주의한다. 보통 초당 동작 수로 기록되어  TPS(transaction per seconds), RPS(requests per seconds), OPS(operation per seconds) 로 불린다. 

Response Time은 클라이언트에서 요청 보낸 후 응답 받기까지의 시간을 측정하는 것으로 응답 시간의 평균을 구하거나, 백분위로 나타내는 방식이 있다. 응답의 90%가 1.5초보다 빠르고 10%가 1.5초 보다 느렸다면 1.5초가 90%대의 응답 시간이 된다. 백분위로 나타내는 방식은 큰 특이 요소의 영향도를 감소시키는데 초점이 있다. 다수 사용자의 경험이 중요하다면 백분위를 사용하고 특이 요소를 놓칠 수 없다면 평균값을 사용하자. 물론 양쪽 다 보는 편이 좋다. 

<br/> 

## 변동성 이해하기
시간이 흐름에 따라 테스트 결과가 어떻게 달라지는지 이해해야 한다. 실세계를 모방하기 위한 기능이 있다면 정확하게 동일한 데이터를 처리할 수 없고 실행할 때마다 다른 결과가 나올 것이다. 테스트를 반복해서 결과의 평균치를 내더라도 불규칙한 변동에 의한 것인지 실제 차이가 있는 것인지 정확히 판단하기는 불가능하다. 다만 통계적으로 유의미한 데이터를 얻을 수는 있다. 통계적으로 유의미한지를 알아보는 방법은 '스튜던트 t 테스트'가 있다. 

<br/> 

## 빠르게 자주 테스트하자
예전 코드와 신규 코드에서 발견되는 차이점이 단순히 임의의 변화가 아니라는 것을 확신하기 위해서는 테스트를 여러번 반복해야 한다. 대형 프로젝트에서는 며칠 또는 한 주 이상 걸릴 수도 있어서 코드 수정시마다 매번 테스트하는 것은 비현실적이다. 그럼에도 성능테스트를 자주하는 것은 중요하다. 시스템 구조적인 변경을 통해서만 신규 코드의 성능 저하를 해결할 수 있다면 빨리 저하 요인을 처리하는 편이 낫다.

빠르고 자주 테스트하기 위해서는 시스템의 전체를 테스트할 수 있는 스크립트(혹은 프로그램)로 만들어져야 한다. 또한 테스트 후 분석에 유용한 데이터를 전부 수집한다. CPU, 디스크, 네트워크, 메모리 사용률 등의 시스템 정보, 애플리케이션 로그와 가비지컬렉션 정보, 힙 데이터 분석 등을 포함한다. 이런 정보들을 분석하여 시스템 성능 저하의 대한 단서로 삼을 수 있다. 

<br/>

<a href="http://www.aladin.co.kr/shop/wproduct.aspx?ItemId=79248318">
  <img class="book" style="width: 30%; height: 30%" src="http://image.aladin.co.kr/product/7924/83/cover/k542434036_1.jpg"/>
</a>

 
