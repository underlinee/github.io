<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>이펙티브 SQL - 집계</title>
  <meta name="description" content="GROUP BY 절은 간단하게 만들자">
  
  <meta name="author" content="JB">
  <meta name="copyright" content="&copy; JB 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  

  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://underlinee.github.io/devbook/2018/03/26/9791160503425.html">
  <link rel="alternate" type="application/rss+xml" title="Underlinee" href="http://underlinee.github.io/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <!-- <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="Underlinee">
      
    </a> -->
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
        
          
          <li class="nav-link"><a href="/bookshelf/">Bookshelf</a>
          
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/posts/">Posts</a>
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">이펙티브 SQL - 집계</h1>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">March 26, 2018</div>
  <div class="post-categories">
  in 
    
    <a href="/category/DevBook">Devbook</a>
    
  
  </div>
</section>

<article class="post-content">
  <h2 id="group-by---">GROUP BY 절은 간단하게 만들자</h2>

<p>특정 유형으로 집계하려면 데이터를 분할해 그룹으로 묶어야 할 때가 종종 있는데, GROUP BY 절로 구현할 수 있다. 그런데 현재 SQL 표준에서 더는 요구하지 않지만 몇몇 DBMS에서는 집계되지 않는 칼럼을 GROUP BY 절에 추가해야 한다.  GROUP BY 절에 칼럼을 과도하게 기술하면 쿼리 성능에 악영향이 있을 뿐만 아니라 읽고 이해하기 어렵다. 따라서 집계와 세부 정보 조회 두 가지 목적을 달성해야 하는 쿼리를 작성할 때는 서브쿼리에서 모든 집계를 수행한 후 세부 데이터를 담은 테이블과 조인해 해당 정보를 가져온다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT c.Customer, c.CustState, c.Name, o.OrderCount
FROM Customers AS c
    LEFT JOIN (
        SELECT t.CustomerID, COUNT(t.OrderNumber) AS OrderCount
        FROM Orders AS t
        GROUP BY t.CustomerID
        ) AS o
    ON c.CustomerID = o.CustomerID;
</code></pre>
</div>

<p><br /></p>

<h2 id="distinct-">겹치지 않는 개수를 얻으려면 DISTINCT를 사용하자</h2>
<p>COUNT() 집계 함수의 목적은 그 이름에서 유추할 수 있다. COUNT()의 용도는 세 가지로 구분할 수 있다.</p>

<ul>
  <li>COUNT(*) : 널 값과 중복된 값을 포함해 한 그룹의 항목 개수를 반환한다.</li>
  <li>COUNT(ALL <표현식>) : 한 그룹의 각 로우에 있는 표현식을 평가해 NULL 이 아닌 값의 개수를 반환한다.</표현식></li>
  <li>COUNT(DISTINCT <표현식>) : 한 그룹에 있는 각 로우에 대해 지정한 표현식을 평가해서 유일하고 널이 아닌 값의 개수를 반환한다.</표현식></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT COUNT(*) AS TotalRows
    COUNT(DISTINCT CustomerID) AS TotalUniqueCustomer
    COUNT(CASE WHEN OrderTotal &gt; 1000 THEN CustomerID END) AS TotalLargeOrders
    COUNT(DISTINCT CASE WHEN OrderTotal &gt; 1000                 
    	THEN CustomerID END) AS TotalUniqCUST_LargeOrders
FROM OrdersTable;
</code></pre>
</div>

<p><br /></p>

<p><a href="http://www.aladin.co.kr/shop/wproduct.aspx?ItemId=124421253">
  <img class="book" style="width: 30%; height: 30%" src="http://image.aladin.co.kr/product/12442/12/cover/k802531656_1.jpg" />
</a></p>


</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/sql">sql</a>,&nbsp;<a href="/tag/groupby">groupby</a>,&nbsp;<a href="/tag/count">count</a>
</section>








<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'underlinee';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer" style="background-image: url(/assets/footer_image.jpg)";>

  <div class="wrapper">

    <h3 class="footer-heading">Underlinee</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
        
        
          <li class="nav-link"><a href="/bookshelf/">Bookshelf</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/posts/">Posts</a>
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:jb.squee@daum.net">
            <i class="fa fa-envelope-o"></i>
            <span class="username">jb.squee@daum.net</span>
          </a>
        </li>
      </ul>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>




<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-112755509-1', 'auto');
  ga('send', 'pageview', {
    'page': '/devbook/2018/03/26/9791160503425.html',
    'title': '이펙티브 SQL - 집계'
  });
</script>



  </body>

</html>
